<div class="container mt-5 p-4 bg-light rounded-4 shadow-sm border" style="max-width: 700px;">
  <h3 class="mb-4 text-center text-primary fw-bold">
    <i class="bi bi-calendar-check"></i> Agendar Cita por Especialidad
  </h3>

  <!-- Especialidad -->
  <div class="mb-4">
    <label for="especialidad" class="form-label fw-semibold">
      <i class="bi bi-stethoscope"></i> Seleccione la Especialidad:
    </label>
    <select id="especialidad" class="form-select" [(ngModel)]="especialidadSeleccionada" name="especialidad" required (change)="onEspecialidadSeleccionada()">
      <option [ngValue]="null">-- Seleccione una especialidad --</option>
      <option *ngFor="let esp of especialidades" [ngValue]="esp">{{ esp.nombre }}</option>
    </select>
  </div>

  <!-- Sede -->
  <div class="mb-4">
    <label for="sede" class="form-label fw-semibold">
      <i class="bi bi-hospital"></i> Seleccione la Sede:
    </label>
    <select id="sede" class="form-select" [(ngModel)]="sedeSeleccionada" name="sede" required (change)="onSedeSeleccionada()">
      <option [ngValue]="null">-- Seleccione una sede --</option>
      <option *ngFor="let sede of sedes" [ngValue]="sede">{{ sede.nombre }}</option>
    </select>
  </div>

  <!-- Médico -->
  <div class="mb-4" *ngIf="medicos.length > 0">
    <label for="medico" class="form-label fw-semibold">
      <i class="bi bi-person-badge"></i> Seleccione el Médico:
    </label>
    <select id="medico" class="form-select" [(ngModel)]="medicoSeleccionado" name="medico" required (change)="actualizarResumen()">
      <option [ngValue]="null">-- Seleccione un médico --</option>
      <option *ngFor="let med of medicos" [ngValue]="med">
        {{ med.nombres }} {{ med.apellidos }}
      </option>
    </select>
  </div>

  <!-- Fecha -->
  <div class="mb-4">
    <label for="fecha" class="form-label fw-semibold">
      <i class="bi bi-calendar-event"></i> Seleccione una Fecha:
    </label>
    <input type="date" id="fecha" class="form-control" name="fecha"
           [(ngModel)]="fechaSeleccionada"
           [min]="hoy" [max]="fechaMaxima"
           (change)="onFechaSeleccionada()" required>
  </div>

<!-- Turno -->
<div class="mb-4">
  <label for="turno" class="form-label fw-semibold">
    <i class="bi bi-clock"></i> Seleccione el Turno:
  </label>
  <select id="turno" class="form-select" [(ngModel)]="turnoSeleccionado" name="turno"
          [disabled]="!medicoSeleccionado || !fechaSeleccionada" (change)="onTurnoSeleccionado()">
    <option [ngValue]="''">-- Seleccione un turno --</option>
    <option *ngFor="let turno of turnosDelMedico" [value]="turno">{{ turno }}</option>
  </select>
</div>


  <!-- Horarios disponibles como botones -->
  <div *ngIf="horariosDisponibles.length > 0" class="text-center my-3">
    <label class="form-label fw-semibold">
      <i class="bi bi-clock-history"></i> Horarios disponibles:
    </label>
    <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
      <button
        *ngFor="let h of horariosDisponibles"
        type="button"
        class="btn"
        [class.btn-outline-primary]="horarioSeleccionado !== h && !horariosOcupados.includes(h)"
        [class.btn-primary]="horarioSeleccionado === h"
        [class.btn-secondary]="horariosOcupados.includes(h)"
        [disabled]="horariosOcupados.includes(h)"
        (click)="seleccionarHorario(h)">
        {{ h }}
      </button>
    </div>
  </div>

  <!-- Resumen -->
  <div class="mb-4" *ngIf="resumen">
    <label class="form-label fw-semibold">
      <i class="bi bi-info-circle"></i> Resumen de Selección:
    </label>
    <textarea class="form-control bg-light" rows="4" readonly>{{ resumen }}</textarea>
  </div>

  <!-- Mensaje de éxito -->
  <div class="alert alert-success text-center fw-semibold" *ngIf="mensajeExito">
    <i class="bi bi-check-circle-fill me-2"></i> ¡Cita registrada con éxito!
  </div>

  <!-- Botón Confirmar -->
  <div class="text-center">
    <button class="btn btn-success px-4 py-2" [disabled]="botonDeshabilitado" (click)="validarYConfirmar()">
      <ng-container *ngIf="botonDeshabilitado; else textoBoton">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Validando...
      </ng-container>
      <ng-template #textoBoton>
        <i class="bi bi-check-circle me-2"></i> Confirmar Cita
      </ng-template>
    </button>
  </div>
</div>
